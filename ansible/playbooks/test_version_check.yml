---
- name: Check IOS-XE Version and Boot Mode
  hosts: switches
  gather_facts: false
  vars:
    target_version: "17.15.04"
    required_space_mb: 2048

    # Model mappings
    target_versions_by_model:
      C9200: "17.15.04"
      C9200CX: "17.15.04"
      C9200L: "17.15.04"
      C9300: "17.15.04"
      C9300X: "17.15.04"
      C9350: "17.15.04"
      C9400: "17.15.04"
      C9500: "17.15.04"
      C9500X: "17.15.04"

    image_files_by_model:
      C9200: "cat9k_iosxe.17.15.04.SPA.bin"
      C9200CX: "cat9k_iosxe.17.15.04.SPA.bin"
      C9200L: "cat9k_iosxe.17.15.04.SPA.bin"
      C9300: "cat9k_iosxe.17.15.04.SPA.bin"
      C9300X: "cat9k_iosxe.17.15.04.SPA.bin"
      C9350: "cat9k_iosxe.17.15.04.SPA.bin"
      C9400: "cat9k_iosxe.17.15.04.SPA.bin"
      C9500: "cat9k_iosxe.17.15.04.SPA.bin"
      C9500X: "cat9k_iosxe.17.15.04.SPA.bin"

  tasks:
    # Gather facts and detect model
    - name: Gather switch facts
      ansible.builtin.include_tasks: tasks/common/gather_switch_facts.yml

    - name: Detect model
      ansible.builtin.include_tasks: tasks/common/detect_model.yml

    - name: Select version and image
      ansible.builtin.include_tasks: tasks/common/select_version_and_image.yml

    # Check boot mode
    - name: Check boot mode
      ansible.builtin.include_tasks: tasks/boot/check_boot_mode.yml

    # Check flash space
    - name: Check flash space
      ansible.builtin.include_tasks: tasks/flash/check_flash_space.yml

    # Check if upgrade needed
    - name: Check upgrade needed
      ansible.builtin.include_tasks: tasks/verify/check_upgrade_needed.yml

    # Display summary
    - name: Display summary
      ansible.builtin.include_tasks: tasks/verify/display_status_summary.yml
